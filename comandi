docker compose down
docker compose up --build
docker compose logs -f node1
docker kill --signal SIGKILL node2


 killare in maniera forzata
 # prendi TUTTI gli id dei container incriminati (nome che inizia per node o registry)
  # per ciascun id estrai il PID host
 IDS=$(docker ps -a --filter "name=node" --filter "name=registry" -q)


 for id in $IDS; do
   echo "Container $id:"
   docker inspect -f ' PID = {{.State.Pid}}' "$id"
 done

for id in $IDS; do
  PID=$(docker inspect -f '{{.State.Pid}}' "$id")
  if [ -n "$PID" ] && [ "$PID" != "0" ]; then
    echo "â†’ kill -9 $PID"
    sudo kill -9 "$PID"
  fi
done



# pulisce i profili zombie
sudo aa-remove-unknown
sudo systemctl restart docker



aggiungere o rimuovere servizi

docker exec node1 sh -c 'echo "ADD sum" >> /tmp/services.ctrl'
docker exec node2 sh -c 'echo "DEL sub" >> /tmp/services.ctrl'


docker compose run --rm --no-deps --name client2 \
  client \
  --id=client2:9010 \
  --port=9010 \
  --registry=registry:9000 \
  --lookup=sub



# crash
docker compose kill node2            # (o docker kill node2)

# stop & start
docker compose stop node1
docker compose start node1



#ricerca con learn from lookup disattivato
 docker compose run --rm --no-deps --name client2 \
  -e SDCC_LEARN_FROM_HB=true \
  -e SDCC_LEARN_FROM_LOOKUP=false\
  client --id=client2:9010 --port=9010 --registry=registry:9000 --lookup=div


  #
  ./deploy_sdcc_ec2.sh ec2-user ec2-50-19-201-206.compute-1.amazonaws.com https://github.com/Polidori1999/ProgettoSDCC.git main



#ricerca
 docker compose run --rm --no-deps --name client2 \
  client --id=client2:9010 --port=9010 --registry=registry:9000 --lookup=div


   docker compose run --rm --no-deps --name client2 \
    -e SDCC_LEARN_FROM_LOOKUP=true \
    -e SDCC_LOOKUP_TTL=1\
    client --id=client2:9010 --port=9010 --registry=registry:9000 --lookup=foo


 #inserire nodo senza registry
 docker compose run -d --no-deps --name node6 node1 \
   --id=node6:9006 --port=9006 \
   --peers=node2:9002 \
   --services=add \
   --svc-ctrl=/tmp/services.ctrl

#inserire nodo con registry
 docker compose run -d --no-deps --name node6 node1 \
   --id=node6:9006 --port=9006 \
   --registry=registry:9000\
   --services=add \
   --svc-ctrl=/tmp/services.ctrl

#per esperimenti


#E1
docker compose down -v
docker compose -f docker-compose.yml -f experiments/E1.yml up -d registry node1 node2 node3 node4 node5
docker compose -f docker-compose.yml -f experiments/E1.yml run --rm client


#E2
docker compose down -v
docker compose -f docker-compose.yml -f experiments/E2.yml up -d registry node1 node2 node3 node4 node5
docker compose -f docker-compose.yml -f experiments/E2.yml run --rm client



